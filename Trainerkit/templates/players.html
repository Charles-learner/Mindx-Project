<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Trainerkit - Qu·∫£n l√Ω C·∫ßu th·ªß</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="static/style1.css" rel="stylesheet">
  <link href="static/style2.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <div class="navbar-container">
        <div class="navbar">
            <div class="navbar-left">
                <a href="/" class="nav-link"><div style="color: #2563eb; font-size: 20px; font-weight: 800;">üè† Home</div></a>
                <a href="/players" class="nav-link"><div>üë• Players</div></a>
                <a href="/chart" class="nav-link"><div>üìä Analysis</div></a>
                <a href="/comp" class="nav-link"><div>üìä Comparison</div></a>   
            </div>
            <div class="navbar-right">
                <div class="sign-in">Sign in</div>
                <div class="join-now">Join now</div>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 class="page-title">‚öΩ Qu·∫£n l√Ω C·∫ßu th·ªß CLB</h1>

        <div id="messageContainer"></div>

        <form id="playerForm" class="player-form">
            <input type="text" id="name" placeholder="üè∑Ô∏è T√™n c·∫ßu th·ªß" required>
            <input type="number" id="age" placeholder="üéÇ Tu·ªïi" required min="16" max="45">
            <select id="position" required>
                <option value="">-- üìç Ch·ªçn v·ªã tr√≠ --</option>
                <option value="GK">ü•Ö Th·ªß m√¥n (GK)</option>
                <option value="LB">‚¨ÖÔ∏è H·∫≠u v·ªá tr√°i (LB)</option>
                <option value="RB">‚û°Ô∏è H·∫≠u v·ªá ph·∫£i (RB)</option>
                <option value="CB">üõ°Ô∏è Trung v·ªá (CB)</option>
                <option value="CDM">‚öîÔ∏è Ti·ªÅn v·ªá ph√≤ng ng·ª± (CDM)</option>
                <option value="CM">‚öΩ Ti·ªÅn v·ªá trung t√¢m (CM)</option>
                <option value="CAM">üéØ Ti·ªÅn v·ªá t·∫•n c√¥ng (CAM)</option>
                <option value="LM">‚¨ÖÔ∏è Ti·ªÅn v·ªá c√°nh tr√°i (LM)</option>
                <option value="RM">‚û°Ô∏è Ti·ªÅn v·ªá c√°nh ph·∫£i (RM)</option>
                <option value="LW">üèÉ Ti·ªÅn ƒë·∫°o c√°nh tr√°i (LW)</option>
                <option value="RW">üèÉ Ti·ªÅn ƒë·∫°o c√°nh ph·∫£i (RW)</option>
                <option value="ST">üéØ Ti·ªÅn ƒë·∫°o c·∫Øm (ST)</option>
            </select>
            <input type="number" id="goals" placeholder="‚öΩ B√†n th·∫Øng" min="0" value="0">
            <input type="number" id="assists" placeholder="üÖ∞Ô∏è Ki·∫øn t·∫°o" min="0" value="0">
            <input type="number" id="stamina" placeholder="üí™ Th·ªÉ l·ª±c (0-100)" min="0" max="100" required>
            <button type="submit" class="submit-btn">
                ‚ûï Th√™m c·∫ßu th·ªß
            </button>
        </form>

        <div class="section-header">
            <h2>üë• Danh s√°ch C·∫ßu th·ªß</h2>
            <div class="player-count" id="playerCount">0 c·∫ßu th·ªß</div>
        </div>
        
        <ul id="playerList"></ul>

        <div class="section-header">
            <h2>üìä Th·ªëng k√™ ƒê·ªôi b√≥ng</h2>
        </div>
        <div id="stats"></div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Ch·ªânh s·ª≠a C·∫ßu th·ªß</h2>
                <button onclick="cancelEdit()" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="editName" placeholder="üè∑Ô∏è T√™n c·∫ßu th·ªß">
                <input type="number" id="editAge" placeholder="üéÇ Tu·ªïi" min="16" max="45">
                <select id="editPosition">
                    <option value="">-- üìç Ch·ªçn v·ªã tr√≠ --</option>
                    <option value="GK">ü•Ö Th·ªß m√¥n (GK)</option>
                    <option value="LB">‚¨ÖÔ∏è H·∫≠u v·ªá tr√°i (LB)</option>
                    <option value="RB">‚û°Ô∏è H·∫≠u v·ªá ph·∫£i (RB)</option>
                    <option value="CB">üõ°Ô∏è Trung v·ªá (CB)</option>
                    <option value="CDM">‚öîÔ∏è Ti·ªÅn v·ªá ph√≤ng ng·ª± (CDM)</option>
                    <option value="CM">‚öΩ Ti·ªÅn v·ªá trung t√¢m (CM)</option>
                    <option value="CAM">üéØ Ti·ªÅn v·ªá t·∫•n c√¥ng (CAM)</option>
                    <option value="LM">‚¨ÖÔ∏è Ti·ªÅn v·ªá c√°nh tr√°i (LM)</option>
                    <option value="RM">‚û°Ô∏è Ti·ªÅn v·ªá c√°nh ph·∫£i (RM)</option>
                    <option value="LW">üèÉ Ti·ªÅn ƒë·∫°o c√°nh tr√°i (LW)</option>
                    <option value="RW">üèÉ Ti·ªÅn ƒë·∫°o c√°nh ph·∫£i (RW)</option>
                    <option value="ST">üéØ Ti·ªÅn ƒë·∫°o c·∫Øm (ST)</option>
                </select>
                <input type="number" id="editGoals" placeholder="‚öΩ B√†n th·∫Øng" min="0">
                <input type="number" id="editAssists" placeholder="üÖ∞Ô∏è Ki·∫øn t·∫°o" min="0">
                <input type="number" id="editStamina" placeholder="üí™ Th·ªÉ l·ª±c" min="0" max="100">
            </div>
            <div class="modal-footer">
                <button onclick="saveEdit()" class="save-btn">üíæ L∆∞u thay ƒë·ªïi</button>
                <button onclick="cancelEdit()" class="cancel-btn">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <script>
        let editingIndex = null;
        
        function showMessage(message, type = 'success') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        
        function showLoading(element) {
            element.classList.add('loading');
        }
        
        function hideLoading(element) {
            element.classList.remove('loading');
        }

        async function fetchPlayers() {
            try {
                const list = document.getElementById('playerList');
                showLoading(list);
                
                const res = await fetch('/api/players');
                if (!res.ok) throw new Error('Failed to fetch players');
                
                const data = await res.json();
                list.innerHTML = '';
                
                document.getElementById('playerCount').textContent = `${data.length} c·∫ßu th·ªß`;
                
                if (data.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚öΩ</div>
                            <h3>Ch∆∞a c√≥ c·∫ßu th·ªß n√†o</h3>
                            <p>H√£y th√™m c·∫ßu th·ªß ƒë·∫ßu ti√™n cho ƒë·ªôi b√≥ng c·ªßa b·∫°n!</p>
                        </div>
                    `;
                    return;
                }
                
                data.forEach((p, i) => {
                    const li = document.createElement('li');
                    li.className = 'player-card';
                    li.innerHTML = `
                        <div class="player-info">
                            <div class="player-name">${p.name}</div>
                            <div class="player-detail">üéÇ ${p.age} tu·ªïi</div>
                            <div class="player-detail">üìç ${p.position}</div>
                            <div class="player-detail">‚öΩ ${p.goals}</div>
                            <div class="player-detail">üÖ∞Ô∏è ${p.assists}</div>
                            <div class="player-detail">üí™ ${p.stamina}</div>
                        </div>
                        <div class="player-actions">
                            <button onclick="editPlayer(${i})" class="btn-edit">‚úèÔ∏è S·ª≠a</button>
                            <button onclick="deletePlayer(${i})" class="btn-delete">üóëÔ∏è X√≥a</button>
                        </div>
                    `;
                    list.appendChild(li);
                });
            } catch (error) {
                showMessage('L·ªói khi t·∫£i danh s√°ch c·∫ßu th·ªß: ' + error.message, 'error');
            } finally {
                hideLoading(document.getElementById('playerList'));
            }
        }

        async function deletePlayer(index) {
            const result = await Swal.fire({
                title: 'X√°c nh·∫≠n x√≥a?',
                text: 'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c·∫ßu th·ªß n√†y?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'X√≥a',
                cancelButtonText: 'H·ªßy'
            });
            
            if (!result.isConfirmed) return;
            
            try {
                const res = await fetch(`/api/players/${index}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('Failed to delete player');
                
                await fetchPlayers();
                await fetchStats();
                
                Swal.fire('ƒê√£ x√≥a!', 'C·∫ßu th·ªß ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng.', 'success');
            } catch (error) {
                Swal.fire('L·ªói!', 'Kh√¥ng th·ªÉ x√≥a c·∫ßu th·ªß: ' + error.message, 'error');
            }
        }

        function editPlayer(index) {
            editingIndex = index;
            fetch('/api/players')
                .then(res => res.json())
                .then(players => {
                    const p = players[index];
                    document.getElementById('editName').value = p.name;
                    document.getElementById('editAge').value = p.age;
                    document.getElementById('editPosition').value = p.position;
                    document.getElementById('editGoals').value = p.goals;
                    document.getElementById('editAssists').value = p.assists;
                    document.getElementById('editStamina').value = p.stamina;
                    document.getElementById('editModal').classList.remove('hidden');
                });
        }

        async function saveEdit() {
            try {
                const updated = {
                    name: document.getElementById('editName').value,
                    age: parseInt(document.getElementById('editAge').value),
                    position: document.getElementById('editPosition').value,
                    goals: parseInt(document.getElementById('editGoals').value) || 0,
                    assists: parseInt(document.getElementById('editAssists').value) || 0,
                    stamina: parseInt(document.getElementById('editStamina').value)
                };

                const res = await fetch(`/api/players/${editingIndex}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updated)
                });
                
                if (!res.ok) throw new Error('Failed to update player');

                document.getElementById('editModal').classList.add('hidden');
                await fetchPlayers();
                await fetchStats();
                
                Swal.fire('Th√†nh c√¥ng!', 'Th√¥ng tin c·∫ßu th·ªß ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.', 'success');
            } catch (error) {
                Swal.fire('L·ªói!', 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin: ' + error.message, 'error');
            }
        }

        function cancelEdit() {
            document.getElementById('editModal').classList.add('hidden');
        }

        async function fetchStats() {
            try {
                const statsDiv = document.getElementById('stats');
                showLoading(statsDiv);
                
                const res = await fetch('/api/stats');
                if (!res.ok) throw new Error('Failed to fetch stats');
                
                const stats = await res.json();
                
                statsDiv.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${stats.avg_goals}</div>
                            <div class="stat-label">‚öΩ Trung b√¨nh b√†n th·∫Øng</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.avg_assists}</div>
                            <div class="stat-label">üÖ∞Ô∏è Trung b√¨nh ki·∫øn t·∫°o</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.avg_stamina}</div>
                            <div class="stat-label">üí™ Th·ªÉ l·ª±c trung b√¨nh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.top_scorer.name || 'N/A'}</div>
                            <div class="stat-label">üèÜ Vua ph√° l∆∞·ªõi (${stats.top_scorer.goals || 0} b√†n)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.top_assist.name || 'N/A'}</div>
                            <div class="stat-label">üéØ Ki·∫øn t·∫°o nhi·ªÅu nh·∫•t (${stats.top_assist.assists || 0} ki·∫øn t·∫°o)</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('stats').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™: ${error.message}</p>
                    </div>
                `;
            } finally {
                hideLoading(document.getElementById('stats'));
            }
        }

        document.getElementById('playerForm').addEventListener('submit', async e => {
            e.preventDefault();
            
            try {
                const form = e.target;
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                
                submitBtn.textContent = '‚è≥ ƒêang th√™m...';
                submitBtn.disabled = true;
                
                const player = {
                    name: document.getElementById('name').value,
                    age: +document.getElementById('age').value,
                    position: document.getElementById('position').value,
                    goals: +document.getElementById('goals').value || 0,
                    assists: +document.getElementById('assists').value || 0,
                    stamina: +document.getElementById('stamina').value
                };
                
                const res = await fetch('/api/players', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(player)
                });
                
                if (!res.ok) throw new Error('Failed to add player');
                
                await fetchPlayers();
                await fetchStats();
                form.reset();
                
                Swal.fire('Th√†nh c√¥ng!', `ƒê√£ th√™m c·∫ßu th·ªß ${player.name} v√†o ƒë·ªôi b√≥ng.`, 'success');
            } catch (error) {
                Swal.fire('L·ªói!', 'Kh√¥ng th·ªÉ th√™m c·∫ßu th·ªß: ' + error.message, 'error');
            } finally {
                const submitBtn = document.querySelector('button[type="submit"]');
                submitBtn.textContent = '‚ûï Th√™m c·∫ßu th·ªß';
                submitBtn.disabled = false;
            }
        });

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelEdit();
            }
        });

        // Initialize
        fetchPlayers();
        fetchStats();
    </script>
</body>
</html>
