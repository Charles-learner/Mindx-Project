<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trainerkit - So sánh</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
</head>
<body class="light">
  <!-- NAV -->
  <div class="navbar-container">
    <div class="navbar">
      <div class="navbar-left">
        <a href="/">🏠 Home</a>
        <a href="/players">👥 Players</a>
        <a href="/chart">📊 Analysis</a>
        <a href="/comp" class="active">📊 Comparison</a>
        <a href="/player">👤 Player</a>
      </div>
      <div class="navbar-right">
        <button id="darkToggle" class="toggle-btn">🌙 Dark Mode</button>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-6 py-28">
    <h1 class="page-title">📈 So sánh cầu thủ</h1>

    <div class="info-card">
      <div class="flex flex-wrap items-center gap-3">
        <select id="p1" class="metric-select"></select>
        <select id="p2" class="metric-select"></select>
        <button id="btnCompare" class="btn btn-primary">🔍 So sánh</button>
      </div>
    </div>

    <div class="chart-box mt-4">
      <h3 class="section-title">Highcharts Radar</h3>
      <div id="radarBox" style="height:500px"></div>
    </div>
  </div>

  <script>
    const body=document.body, nav=document.querySelector('.navbar-container');
    document.getElementById('darkToggle').onclick=()=>{ 
      body.classList.toggle('dark'); nav.classList.toggle('dark'); 
      document.getElementById('darkToggle').textContent = body.classList.contains('dark')?'🌞 Light Mode':'🌙 Dark Mode';
      if (window._lastComp) drawRadar(window._lastComp.categories, window._lastComp.series);
    };

    async function loadPlayers(){
      const res = await fetch('/api/players'); 
      const data = await res.json();
      const p1 = document.getElementById('p1'); 
      const p2 = document.getElementById('p2');
      [p1,p2].forEach(sel=>{
        sel.innerHTML='';
        data.forEach(p=>{
          const o=document.createElement('option'); 
          o.value=p.name; 
          o.textContent=p.name; 
          sel.appendChild(o);
        });
      });
    }

    async function compare(){
      const p1=document.getElementById('p1').value;
      const p2=document.getElementById('p2').value;
      if(!p1||!p2||p1===p2) return;
      const res=await fetch(`/api/comp?player1=${encodeURIComponent(p1)}&player2=${encodeURIComponent(p2)}`);
      if(!res.ok){ alert('Không lấy được dữ liệu so sánh'); return; }
      const {categories, series} = await res.json();
      window._lastComp = {categories, series};
      drawRadar(categories, series);
    }

    function drawRadar(categories, series){
      const dark=body.classList.contains('dark');
      Highcharts.chart('radarBox',{
        chart:{ polar:true, type:'line', backgroundColor: dark?'#1f2937':'#ffffff' },
        title:{ 
          text:'So sánh chỉ số cầu thủ',
          style:{ color:dark?'#f9fafb':'#111827', fontFamily:'Inter, sans-serif', fontWeight:'700' }
        },
        pane:{ size:'80%' },
        xAxis:{ 
          categories, tickmarkPlacement:'on', lineWidth:0, 
          labels:{ style:{ color: dark?'#f9fafb':'#111' } } 
        },
        yAxis:{ 
          gridLineInterpolation:'polygon', lineWidth:0, min:0, 
          labels:{ style:{ color: dark?'#f9fafb':'#111' } } 
        },
        tooltip:{ shared:true, pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>' },
        legend:{ align:'center', verticalAlign:'bottom', itemStyle:{ color: dark?'#f9fafb':'#111' } },
        series: series,
        credits:{ enabled:false }
      });
    }

    document.getElementById('btnCompare').onclick = compare;
    loadPlayers();
  </script>
</body>
</html>


