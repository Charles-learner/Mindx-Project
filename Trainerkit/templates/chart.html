<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trainerkit - Thống kê</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/highcharts-more.js"></script>
</head>
<body class="light">
  <!-- NAV -->
  <div class="navbar-container">
    <div class="navbar">
      <div class="navbar-left">
        <a href="/">🏠 Home</a>
        <a href="/players">👥 Players</a>
        <a href="/chart" class="active">📊 Analysis</a>
        <a href="/comp">📊 Comparison</a>
        <a href="/player">👤 Player</a>
      </div>
      <div class="navbar-right">
        <button id="darkToggle" class="toggle-btn">🌙 Dark Mode</button>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-6 py-28">
    <h1 class="page-title">📊 Thống kê đội bóng</h1>

    <div class="grid-2 mt-6">
      <div class="chart-box">
        <h3 class="section-title">Goals & Assists</h3>
        <div id="goalsChart" style="height:420px"></div>
      </div>
      <div class="chart-box">
        <h3 class="section-title">Stamina trung bình</h3>
        <div id="staminaChart" style="height:420px"></div>
      </div>
    </div>

    <div class="grid-2 mt-6">
      <div class="chart-box">
        <h3 class="section-title">Passes Completed</h3>
        <div id="passesChart" style="height:420px"></div>
      </div>
      <div class="chart-box">
        <h3 class="section-title">Tackles & Interceptions</h3>
        <div id="defenseChart" style="height:420px"></div>
      </div>
    </div>

    <div class="chart-box mt-6">
      <h3 class="section-title">Phân bố độ tuổi cầu thủ</h3>
      <div id="ageChart" style="height:420px"></div>
    </div>
  </div>

  <script>
    const body=document.body, nav=document.querySelector('.navbar-container');
    document.getElementById('darkToggle').onclick=()=>{
      body.classList.toggle('dark'); nav.classList.toggle('dark');
      document.getElementById('darkToggle').textContent = body.classList.contains('dark')?'🌞 Light Mode':'🌙 Dark Mode';
      drawCharts(window._lastData);
    };

    async function loadData(){
      const res=await fetch('/api/players'); const data=await res.json();
      window._lastData=data;
      drawCharts(data);
    }

    function chartColors(){
      const dark=body.classList.contains('dark');
      return {
        bg: dark ? '#1f2937' : '#ffffff',
        text: dark ? '#f9fafb' : '#111827'
      };
    }

    function drawCharts(data){
      if(!data) return;
      const {bg,text}=chartColors();

      // Goals & Assists
      Highcharts.chart('goalsChart',{
        chart:{ type:'column', backgroundColor:bg },
        title:{ text:'Goals & Assists', style:{ color:text } },
        xAxis:{ categories:data.map(p=>p.name), labels:{ style:{ color:text } } },
        yAxis:{ title:{ text:'Số lượng', style:{ color:text } }, labels:{ style:{ color:text } } },
        legend:{ itemStyle:{ color:text } },
        series:[
          { name:'Goals', data:data.map(p=>+p.goals||0) },
          { name:'Assists', data:data.map(p=>+p.assists||0) }
        ],
        credits:{ enabled:false }
      });

      // Stamina
      Highcharts.chart('staminaChart',{
        chart:{ type:'line', backgroundColor:bg },
        title:{ text:'Stamina trung bình', style:{ color:text } },
        xAxis:{ categories:data.map(p=>p.name), labels:{ style:{ color:text } } },
        yAxis:{ title:{ text:'Stamina', style:{ color:text } }, labels:{ style:{ color:text } } },
        legend:{ itemStyle:{ color:text } },
        series:[{ name:'Stamina', data:data.map(p=>+p.stamina||0) }],
        credits:{ enabled:false }
      });

      // Passes Completed
      Highcharts.chart('passesChart',{
        chart:{ type:'bar', backgroundColor:bg },
        title:{ text:'Passes Completed', style:{ color:text } },
        xAxis:{ categories:data.map(p=>p.name), labels:{ style:{ color:text } } },
        yAxis:{ title:{ text:'Passes', style:{ color:text } }, labels:{ style:{ color:text } } },
        legend:{ itemStyle:{ color:text } },
        series:[{ name:'Passes Completed', data:data.map(p=>+p.passes_completed||0) }],
        credits:{ enabled:false }
      });

      // Tackles & Interceptions
      Highcharts.chart('defenseChart',{
        chart:{ type:'column', backgroundColor:bg },
        title:{ text:'Tackles & Interceptions', style:{ color:text } },
        xAxis:{ categories:data.map(p=>p.name), labels:{ style:{ color:text } } },
        yAxis:{ title:{ text:'Số lượng', style:{ color:text } }, labels:{ style:{ color:text } } },
        legend:{ itemStyle:{ color:text } },
        series:[
          { name:'Tackles', data:data.map(p=>+p.tackles||0) },
          { name:'Interceptions', data:data.map(p=>+p.interceptions||0) }
        ],
        credits:{ enabled:false }
      });

      // Age Chart
      Highcharts.chart('ageChart',{
        chart:{ type:'column', backgroundColor:bg },
        title:{ text:'Phân bố độ tuổi cầu thủ', style:{ color:text } },
        xAxis:{ categories:data.map(p=>p.name), labels:{ style:{ color:text } } },
        yAxis:{ title:{ text:'Tuổi', style:{ color:text } }, labels:{ style:{ color:text } } },
        legend:{ itemStyle:{ color:text } },
        series:[{ name:'Age', data:data.map(p=>+p.age||0) }],
        credits:{ enabled:false }
      });
    }

    loadData();
  </script>
</body>
</html>



